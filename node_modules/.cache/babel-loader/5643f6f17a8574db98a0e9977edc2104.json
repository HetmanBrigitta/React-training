{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport JwtDecode from 'jwt-decode';\nimport { authApi } from '../api/authApi';\nimport { authActions } from '../store/reducers/authReducer';\n\nconst useAuth = () => {\n  _s();\n\n  const [error, setError] = useState('');\n  const dispatch = useDispatch();\n\n  const handleLogin = token => {\n    localStorage.setItem('authToken', token);\n    const decodedToken = JwtDecode(token);\n    dispatch(authActions.setUserInfo(decodedToken));\n    console.log('token:', decodedToken);\n  };\n\n  const login = async values => {\n    setError('');\n    await authApi.login(values).then(({\n      data\n    }) => handleLogin(data.token)).catch(({\n      response\n    }) => !error && setError(response.data.error));\n  };\n\n  const register = async values => {\n    const username = values.get('username');\n    const password = values.get('password');\n    authApi.register(values).then(() => {\n      if (username && password) {\n        return login({\n          username: username.toString(),\n          password: password.toString()\n        });\n      }\n    }).catch(({\n      response\n    }) => !error && setError(response.data.error));\n  };\n\n  return [login, register, error];\n};\n\n_s(useAuth, \"lqCgD3SUoe0A7GdMZCbhCgoiS2o=\", false, function () {\n  return [useDispatch];\n});\n\nexport default useAuth;","map":{"version":3,"sources":["/home/brigitta.hetman/B/OFFICE/my_projects/hotel-service-management/src/hooks/useAuth.ts"],"names":["useState","useDispatch","JwtDecode","authApi","authActions","useAuth","error","setError","dispatch","handleLogin","token","localStorage","setItem","decodedToken","setUserInfo","console","log","login","values","then","data","catch","response","register","username","get","password","toString"],"mappings":";;AAAA,SAASA,QAAT,QAAyB,OAAzB;AACA,SAASC,WAAT,QAA4B,aAA5B;AACA,OAAOC,SAAP,MAAsB,YAAtB;AAEA,SAASC,OAAT,QAAwB,gBAAxB;AACA,SAASC,WAAT,QAA4B,+BAA5B;;AAeA,MAAMC,OAAO,GAAG,MAAe;AAAA;;AAC7B,QAAM,CAACC,KAAD,EAAQC,QAAR,IAAoBP,QAAQ,CAAS,EAAT,CAAlC;AACA,QAAMQ,QAAQ,GAAGP,WAAW,EAA5B;;AAEA,QAAMQ,WAAW,GAAIC,KAAD,IAAyB;AAC3CC,IAAAA,YAAY,CAACC,OAAb,CAAqB,WAArB,EAAkCF,KAAlC;AACA,UAAMG,YAAmB,GAAGX,SAAS,CAACQ,KAAD,CAArC;AACAF,IAAAA,QAAQ,CAACJ,WAAW,CAACU,WAAZ,CAAwBD,YAAxB,CAAD,CAAR;AACAE,IAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBH,YAAtB;AACD,GALD;;AAOA,QAAMI,KAAK,GAAG,MAAOC,MAAP,IAAwC;AACpDX,IAAAA,QAAQ,CAAC,EAAD,CAAR;AAEA,UAAMJ,OAAO,CACVc,KADG,CACGC,MADH,EAEHC,IAFG,CAEE,CAAC;AAAEC,MAAAA;AAAF,KAAD,KAAcX,WAAW,CAACW,IAAI,CAACV,KAAN,CAF3B,EAGHW,KAHG,CAGG,CAAC;AAAEC,MAAAA;AAAF,KAAD,KAAkC,CAAChB,KAAD,IAAUC,QAAQ,CAACe,QAAQ,CAACF,IAAT,CAAcd,KAAf,CAHvD,CAAN;AAID,GAPD;;AASA,QAAMiB,QAAQ,GAAG,MAAOL,MAAP,IAA2C;AAC1D,UAAMM,QAAQ,GAAGN,MAAM,CAACO,GAAP,CAAW,UAAX,CAAjB;AACA,UAAMC,QAAQ,GAAGR,MAAM,CAACO,GAAP,CAAW,UAAX,CAAjB;AAEAtB,IAAAA,OAAO,CACJoB,QADH,CACYL,MADZ,EAEGC,IAFH,CAEQ,MAAM;AACV,UAAIK,QAAQ,IAAIE,QAAhB,EAA0B;AACxB,eAAOT,KAAK,CAAC;AAAEO,UAAAA,QAAQ,EAAEA,QAAQ,CAACG,QAAT,EAAZ;AAAiCD,UAAAA,QAAQ,EAAEA,QAAQ,CAACC,QAAT;AAA3C,SAAD,CAAZ;AACD;AACF,KANH,EAOGN,KAPH,CAOS,CAAC;AAAEC,MAAAA;AAAF,KAAD,KAAkC,CAAChB,KAAD,IAAUC,QAAQ,CAACe,QAAQ,CAACF,IAAT,CAAcd,KAAf,CAP7D;AAQD,GAZD;;AAcA,SAAO,CAACW,KAAD,EAAQM,QAAR,EAAkBjB,KAAlB,CAAP;AACD,CAnCD;;GAAMD,O;UAEaJ,W;;;AAmCnB,eAAeI,OAAf","sourcesContent":["import { useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport JwtDecode from 'jwt-decode';\n\nimport { authApi } from '../api/authApi';\nimport { authActions } from '../store/reducers/authReducer';\n\nimport { IAuth } from '../interfaces/IAuth';\nimport { IUser } from '../interfaces/IUser';\n\ntype TReturn = [(values: IAuth) => Promise<void>, (values: FormData) => Promise<void>, string];\n\ninterface IErrorResponse {\n  response: {\n    data: {\n      error: string;\n    };\n  };\n}\n\nconst useAuth = (): TReturn => {\n  const [error, setError] = useState<string>('');\n  const dispatch = useDispatch();\n\n  const handleLogin = (token: string): void => {\n    localStorage.setItem('authToken', token);\n    const decodedToken: IUser = JwtDecode(token);\n    dispatch(authActions.setUserInfo(decodedToken));\n    console.log('token:', decodedToken);\n  };\n\n  const login = async (values: IAuth): Promise<void> => {\n    setError('');\n\n    await authApi\n      .login(values)\n      .then(({ data }) => handleLogin(data.token))\n      .catch(({ response }: IErrorResponse) => !error && setError(response.data.error));\n  };\n\n  const register = async (values: FormData): Promise<void> => {\n    const username = values.get('username');\n    const password = values.get('password');\n\n    authApi\n      .register(values)\n      .then(() => {\n        if (username && password) {\n          return login({ username: username.toString(), password: password.toString() });\n        }\n      })\n      .catch(({ response }: IErrorResponse) => !error && setError(response.data.error));\n  };\n\n  return [login, register, error];\n};\n\nexport default useAuth;\n"]},"metadata":{},"sourceType":"module"}